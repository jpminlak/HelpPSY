<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자유 게시판</title>
    <link rel="stylesheet" th:href="@{/main/head.css}">
    <script th:src="@{/main/fragment.js}"></script>
</head>

<body>
<div class="wrapper">
    <div class="header-container">
        <div class="logo-nav-container">
            <div class="logo-container">
                <img id="like" th:src="@{/LikeImg/차량사고 커뮤니티 로고.png}" width="150" alt="로고">
                <h2><b>Help PSY</b></h2>
            </div>
            <div class="nav-links">
                <a href="/main">메인 화면</a>
                <a href="/mainFreeBulletin">자유게시판</a>
                <a href="/accidentmain">사고게시판</a>
                <a href="/inquiry">문의하기</a>
                <a th:if="${session.userId == 'aa'}" href="/respondent">답변 (관리자)</a>
                <a href="/map">지도</a>
            </div>
            <div class="login-section">
                <div id="memberBox">
                    <div th:if="${session.userAlias == null}">
                        <a href="/signInMain"><input type="button" value="로그인"></a>
                        <a href="/signUpMain"><input type="button" value="회원가입"></a>
                    </div>
                    <div th:if="${session.userAlias != null}">
                        <label th:text="${session.userAlias} + '님 환영합니다.'"></label>
                        <a th:href="@{'/profile?alias=' + ${session.userAlias}}"><input type="button" value="정보"></a>
                        <input type="button" value="로그아웃" onclick="logout()">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main>
        <div id="poppularBulletin">
            <h1>(추천 게시물) 공사중...</h1>
        </div>

        <div id="wholeBulletin">
            <input id="searchWord" type="text" placeholder="검색어를 입력하세요">
            <input id="searchBtn" type="button" value="검색">
            <input id="newBulletin" type="button" value="게시글 작성" onclick="addBulletin()">

            <div id="bulletins">
                <table id="allListV_v1">
                    <tr>
                        <th id="col1">글 번호</th>
                        <th id="col2">조회수</th>
                        <th id="col3">좋아요</th>
                        <th id="col4">제목</th>
                        <th id="col5">작성자</th>
                        <th id="col6">작성일자</th>
                    </tr>
                    <tr th:each="bulletinOne : ${perPageList}">
                        <td th:text="${bulletinOne.no}"></td>
                        <td th:text="${bulletinOne.views}"></td>
                        <td th:text="${bulletinOne.likes}"></td>
                        <td>
                            <a th:text="${bulletinOne.title}"
                               th:href="@{specificBulletin(no=${bulletinOne.no}, userName=${session.userAlias})}"></a>
                        </td>
                        <td th:text="${bulletinOne.writer}"></td>
                        <td th:text="${#temporals.format(bulletinOne.createDate, 'yyyy-MM-dd')}"></td>
                    </tr>
                </table>

                <div id="paginBox">
                    <table>
                        <tr>
                            <td><input type="button" value="<<" onclick="leftPageNumListNum()"></td>
                            <td><input type="button" value="<" onclick="leftPaging()"></td>
                            <td th:each="num : ${currentPageNums}">
                                <a class="pageNums" th:text="${num}"
                                   th:href="@{mainFreeBulletin(page=${num}, currentPageNum=${currentPageNum})}"></a>
                            </td>
                            <td><input type="button" value=">" onclick="rightPaging()"></td>
                            <td><input type="button" value=">>" onclick="RightPageNumListNum()"></td>
                        </tr>
                    </table>

                    <input id="currentPage" type="hidden" th:value="${currentPage}">
                    <input id="currentPageNum" type="hidden" th:value="${currentPageNum}">
                    <input id="pageNumSetCnt" type="hidden" th:value="${pageNumSetCnt}">
                    <input id="allPageNumCnt" type="hidden" th:value="${allPageNumCnt}">
                </div>
            </div>
        </div>
    </main>

    <div id="footer">
        <p>개발자 이메일 : human@gmail.com | 대표 이름 : human</p>
    </div>
</div>

<script>
    function logout() {
        location.href = '/logout';
    }

    function addBulletin() {
        location.href = "addFreeBulletinMain";
    }

    function onloadPaging() {
        const pages = document.getElementsByClassName('pageNums');
        const currentPage = document.getElementById('currentPage').value;
        for (let i = 0; i < pages.length; i++) {
            if (Number(pages[i].innerHTML) === Number(currentPage)) {
                pages[i].style.color = "blue";
                return;
            }
        }
    }

    function leftPaging() {
        let currentPageNum = Number(document.getElementById('currentPageNum').value);
        let currentPage = Number(document.getElementById('currentPage').value);
        let pages = document.getElementsByClassName('pageNums');
        let firstPage = Number(pages[0].innerHTML);
        if (currentPage > 1) {
            currentPage--;
            if (firstPage > currentPage) currentPageNum--;
            location.href = `mainFreeBulletin?page=${currentPage}&currentPageNum=${currentPageNum}`;
        }
    }

    function rightPaging() {
        let currentPageNum = Number(document.getElementById('currentPageNum').value);
        let currentPage = Number(document.getElementById('currentPage').value);
        let totalPages = Number(document.getElementById('allPageNumCnt').value);
        let pages = document.getElementsByClassName('pageNums');
        let lastPage = Number(pages[pages.length - 1].innerHTML);
        if (currentPage < totalPages) {
            currentPage++;
            if (currentPage > lastPage) currentPageNum++;
            location.href = `mainFreeBulletin?page=${currentPage}&currentPageNum=${currentPageNum}`;
        }
    }

    function leftPageNumListNum() {
        let currentPageNum = Number(document.getElementById('currentPageNum').value);
        let cnt = document.getElementsByClassName('pageNums').length;
        if (currentPageNum > 1) {
            currentPageNum--;
            let page = (currentPageNum - 1) * cnt + 1;
            location.href = `mainFreeBulletin?page=${page}&currentPageNum=${currentPageNum}`;
        }
    }

    function RightPageNumListNum() {
        let currentPageNum = Number(document.getElementById('currentPageNum').value);
        let pageNumSetCnt = Number(document.getElementById('pageNumSetCnt').value);
        let cnt = document.getElementsByClassName('pageNums').length;
        if (currentPageNum < pageNumSetCnt) {
            currentPageNum++;
            let page = (currentPageNum - 1) * cnt + 1;
            location.href = `mainFreeBulletin?page=${page}&currentPageNum=${currentPageNum}`;
        }
    }

    window.onload = () => {
        document.getElementById('mainTitle').innerText = '자유 게시판';
        onloadPaging();
    }
</script>
</body>
</html>
